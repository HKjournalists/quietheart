http://baike.baidu.com/view/1817587.htm
watchdog
百科名片

在由单片机构成的微型计算机系统中,由于单片机的工作常常会受到来自外界电磁场的干扰,造成程序的跑飞,而陷入死循环,程序的正常运行被打断,由单片机控制的系统无法继续工作,会造成整个系统的陷入停滞状态,发生不可预料的后果,所以出于对单片机运行状态进行实时监测的考虑,便产生了一种专门用于监测单片机程序运行状态的芯片,俗称"看门狗"。

目录

    定义
    原理
    工作原理
    设计思路
    用例
    使用注意
    意义

编辑本段定义
　　看门狗,又叫 watchdog timer,是一个定时器电路, 一般有一个输入,叫喂狗,一个输出到MCU的RST端,MCU正常工作的时候,每隔一段时间输出一个信号到喂狗端,给 WDT 清零,如果超过规定时间不喂狗(一般在程序跑飞时),WDT 定时超过,就会给出一个复位信号到MCU,使MCU复位. 防止MCU死机. 看门狗的作用就是防止程序发生死循环或者说程序跑飞。
编辑本段原理
　　看门狗电路的应用,使单片机可以在无人状态下实现连续工作,其工作原理是:看门狗芯片和单片机的一个I/O引脚相连,该I/O引脚通过程序控制它定时地往看门狗的这个引脚上送入高电平(或低电平),这一程序语句是分散地放在单片机其他控制语句中间的，一旦单片机由于干扰造成程序跑飞后而陷入某一程序段 进入死循环状态时,写看门狗引脚的程序便不能被执行,这个时候,看门狗电路就会由于得不到单片机送来的信号,便在它和单片机复位引脚相连的引脚上送出一个复位信号,使单片机发生复位,即程序从程序存储器的起始位置开始执行,这样便实现了单片机的自动复位.
编辑本段工作原理
　　在系统运行以后也就启动了看门狗的计数器，看门狗就开始自动计数，如果到了一定的时间还不去清看门狗，那么看门狗计数器就会溢出从而引起看门狗中断，造成系统复位。所以在使用有看门狗的芯片时要注意清看门狗。
　　硬件看门狗是利用了一个定时器，来监控主程序的运行，也就是说在主程序的运行过程中，我们要在定时时间到之前对定时器进行复位如果出现死循环，或者说PC指针不能回来。那么定时时间到后就会使单片机复位。常用的WDT芯片如MAX813 ,5045, IMP 813等,价格4~10元不等.
　　软件看门狗技术的原理和这差不多，只不过是用软件的方法实现，我们还是以51系列来讲，我们知道在51单片机中有两个定时器，我们就可以用这两个定时器来对主程序的运行进行监控。我们可以对T0设定一定的定时时间，当产生定时中断的时候对一个变量进行赋值，而这个变量在主程序运行的开始已经有了一个初值，在这里我们要设定的定时值要小于主程序的运行时间，这样在主程序的尾部对变量的值进行判断，如果值发生了预期的变化，就说明T0中断正常，如果没有发生变化则使程序复位。对于T1我们用来监控主程序的运行，我们给T1设定一定的定时时间，在主程序中对其进行复位，如果不能在一定的时间里对其进行复位，T1 的定时中断就会使单片机复位。在这里T1的定时时间要设的大于主程序的运行时间，给主程序留有一定的的裕量。而T1的中断正常与否我们再由T0定时中断子程序来监视。这样就够成了一个循环，T0监视T1，T1监视主程序，主程序又来监视T0，从而保证系统的稳定运行。
编辑本段设计思路
　　系统软件"看门狗"的设计思路：
　　1.看门狗定时器T0的设置。在初始化程序块中设置T0的工作方式，并开启中断和计数功能。系统Fosc=12 MHz，T0为16位计数器，最大计数值为(2的16次方)-1=65 535，T0输入计数频率是．Fosc/12，溢出周期为(65 535+1)／1=65 536(μs)。
　　2.计算主控程序循环一次的耗时。考虑系统各功能模块及其循环次数，本系统主控制程序的运行时间约为16．6 ms。系统设置"看门狗"定时器T0定时30 ms(T0的初值为65 536-30 000=35 536)。主控程序的每次循环都将刷新T0的初值。如程序进入"死循环"而T0的初值在30 ms内未被刷新，这时"看门狗"定时器T0将溢出并申请中断。
　　3.设计T0溢出所对应的中断服务程序。此子程序只须一条指令，即在T0对应的中断向量地址(000BH)写入"无条件转移"命令，把计算机拖回整个程序的第一行，对单片机重新进行初始化并获得正确的执行顺序
编辑本段用例
　　51 系列有专门的看门狗定时器,对系统频率进行分频计数,定时器溢出时,将引起复位.看门狗可设定溢出率,也可单独用来作为定时器使用.
　　凌阳61的看门狗比较单一，一个是时间单一，第二是功能在实际的使用中只需在循环当中加入清狗的指令就OK了。
　　C8051Fxxx单片机内部也有一个21位的使用系统时钟的定时器，该定时器检测对其控制 寄存器的两次特定写操作的时间间隔。如果这个时间间隔超过了编程的极限值，将产生一个WDT复位
编辑本段使用注意
　　大多数51 系列单片机都有看门狗,当看门狗没有被定时清零时,将引起复位。这可防止程序跑飞。设计者必须清楚看门狗的溢出时间以决定在合适的时候，清看门狗。清看门狗也不能太过频繁否则会造成资源浪费。程序正常运行时，软件每隔一定的时间(小于定时器的溢出周期)给定时器置数，即可预防溢出中断而引起的误复位。
编辑本段意义
　　看门狗运用：看门狗是恢复系统的正常运行及有效的监视管理器（具有锁定光驱，锁定任何指定程序的作用，可用在家庭中防止小孩无节制地玩游戏、上网、看录像）等具有很好的应用价值.

