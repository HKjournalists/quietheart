
http://baike.baidu.com/view/577140.htm

L2 CACHE＝二级缓存
　　它是处理器内部的一些缓冲存储器，其作用跟内存一样。 它是怎么出现的呢？要上溯到上个世纪80年代，由于处理器的运行速度越来越快，慢慢地，处理器需要从内存中读取数据的速度需求就越来越高了。然而内存的速度提升速度却很缓慢，而能高速读写数据的内存价格又非常高昂，不能大量采用。从性能价格比的角度出发，英特尔等处理器设计生产公司想到一个办法，就是用少量的高速内存和大量的低速内存结合使用，共同为处理器提供数据。这样就兼顾了性能和使用成本的最优。而那些高速的内存因为是处于CPU和内存之间的位置，又是临时存放数据的地方，所以就叫做缓冲存储器了，简称“缓存”。它的作用就像仓库中临时堆放货物的地方一样，货物从运输车辆上放下时临时堆放在缓存区中，然后再搬到内部存储区中长时间存放。货物在这段区域中存放的时间很短，就是一个临时货场。最初缓存只有一级，后来处理器速度又提升了，一级缓存不够用了，于是就添加了二级缓存。二级缓存是比一级缓存速度更慢，容量更大的内存，主要就是做一级缓存和内存之间数据临时交换的地方用。现在，为了适应速度更快的处理器P4EE，已经出现了三级缓存了，它的容量更大，速度相对二级缓存也要慢一些，但是比内存可快多了。缓存的出现使得CPU处理器的运行效率得到了大幅度的提升，这个区域中存放的都是CPU频繁要使用的数据，所以缓存越大处理器效率就越高，同时由于缓存的物理结构比内存复杂很多，所以其成本也很高。
　　大量使用二级缓存带来的结果是处理器运行效率的提升和成本价格的大幅度不等比提升。举个例子，服务器上用的至强处理器和普通的P4处理器其内核基本上是一样的，就是二级缓存不同。至强的二级缓存是2MB～16MB，P4的二级缓存是512KB，于是最便宜的至强也比最贵的P4贵，原因就在二级缓存不同。
　　即L2 Cache。由于L1级高速缓存容量的限制，为了再次提高CPU的运算速度，在CPU外部放置一高速存储器，即二级缓存。工作主频比较灵活，可与CPU同频，也可不同。CPU在读取数据时，先在L1中寻找，再从L2寻找，然后是内存，在后是外存储器。所以L2对系统的影响也不容忽视。
　　CPU缓存（Cache Memory）位于CPU与内存之间的临时存储器，它的容量比内存小但交换速度快。在缓存中的数据是内存中的一小部分，但这一小部分是短时间内CPU即将访问的，当CPU调用大量数据时，就可避开内存直接从缓存中调用，从而加快读取速度。由此可见，在CPU中加入缓存是一种高效的解决方案，这样整个内存储器（缓存+内存）就变成了既有缓存的高速度，又有内存的大容量的存储系统了。缓存对CPU的性能影响很大，主要是因为CPU的数据交换顺序和CPU与缓存间的带宽引起的。
　　缓存的工作原理是当CPU要读取一个数据时，首先从缓存中查找，如果找到就立即读取并送给 CPU处理；如果没有找到，就用相对慢的速度从内存中读取并送给CPU处理，同时把这个数据所在的数据块调入缓存中，可以使得以后对整块数据的读取都从缓存中进行，不必再调用内存。
　　正是这样的读取机制使CPU读取缓存的命中率非常高（大多数CPU可达90%左右），也就是说 CPU下一次要读取的数据90%都在缓存中，只有大约10%需要从内存读取。这大大节省了CPU直接读取内存的时间，也使CPU读取数据时基本无需等待。总的来说，CPU读取数据的顺序是先缓存后内存。
　　最早先的CPU缓存是个整体的，而且容量很低，英特尔公司从Pentium时代开始把缓存进行了分类。当时集成在CPU内核中的缓存已不足以满足CPU的需求，而制造工艺上的限制又不能大幅度提高缓存的容量。因此出现了集成在与CPU同一块电路板上或主板上的缓存，此时就把 CPU内核集成的缓存称为一级缓存，而外部的称为二级缓存。一级缓存中还分数据缓存（Data Cache，D-Cache）和指令缓存（Instruction Cache，I-Cache）。二者分别用来存放数据和执行这些数据的指令，而且两者可以同时被CPU访问，减少了争用Cache所造成的冲突，提高了处理器效能。英特尔公司在推出Pentium 4处理器时，用新增的一种一级追踪缓存替代指令缓存，容量为12KμOps，表示能存储12K条微指令。
　　随着CPU制造工艺的发展，二级缓存也能轻易的集成在CPU内核中，容量也在逐年提升。现在再用集成在CPU内部与否来定义一、二级缓存，已不确切。而且随着二级缓存被集成入CPU内核中，以往二级缓存与CPU大差距分频的情况也被改变，此时其以相同于主频的速度工作，可以为CPU提供更高的传输速度。
　　二级缓存是CPU性能表现的关键之一，在CPU核心不变化的情况下，增加二级缓存容量能使性能大幅度提高。而同一核心的CPU高低端之分往往也是在二级缓存上有差异，由此可见二级缓存对于CPU的重要性。
　　CPU在缓存中找到有用的数据被称为命中，当缓存中没有CPU所需的数据时（这时称为未命中），CPU才访问内存。从理论上讲，在一颗拥有二级缓存的CPU中，读取一级缓存的命中率为80%。也就是说CPU一级缓存中找到的有用数据占数据总量的80%，剩下的20%从二级缓存中读取。由于不能准确预测将要执行的数据，读取二级缓存的命中率也在80%左右（从二级缓存读到有用的数据占总数据的 16%）。那么还有的数据就不得不从内存调用，但这已经是一个相当小的比例了。目前的较高端的CPU中，还会带有三级缓存，它是为读取二级缓存后未命中的数据设计的—种缓存，在拥有三级缓存的CPU中，只有约5%的数据需要从内存中调用，这进一步提高了CPU的效率。
　　为了保证CPU访问时有较高的命中率，缓存中的内容应该按一定的算法替换。一种较常用的算法是 “最近最少使用算法”（LRU算法），它是将最近一段时间内最少被访问过的行淘汰出局。因此需要为每行设置一个计数器，LRU算法是把命中行的计数器清零，其他各行计数器加1。当需要替换时淘汰行计数器计数值最大的数据行出局。这是一种高效、科学的算法，其计数器清零过程可以把一些频繁调用后再不需要的数据淘汰出缓存，提高缓存的利用率。
　　CPU产品中，一级缓存的容量基本在4KB到64KB之间，二级缓存的容量则分为128KB、 256KB、512KB、1MB、2MB等。一级缓存容量各产品之间相差不大，而二级缓存容量则是提高CPU性能的关键。二级缓存容量的提升是由CPU制造工艺所决定的，容量增大必然导致CPU内部晶体管数的增加，要在有限的CPU面积上集成更大的缓存，对制造工艺的要求也就越高
　　缓存(Cache)大小是CPU的重要指标之一，其结构与大小对CPU速度的影响非常大。简单地讲，缓存就是用来存储一些常用或即将用到的数据或指令，当需要这些数据或指令的时候直接从缓存中读取，这样比到内存甚至硬盘中读取要快得多，能够大幅度提升CPU的处理速度。
　　所谓处理器缓存，通常指的是二级高速缓存，或外部高速缓存。即高速缓冲存储器，是位于CPU和主存储器DRAM(Dynamic RAM)之间的规模较小的但速度很高的存储器，通常由SRAM（静态随机存储器）组成。用来存放那些被CPU频繁使用的数据，以便使CPU不必依赖于速度较慢的DRAM（动态随机存储器）。L2高速缓存一直都属于速度极快而价格也相当昂贵的一类内存，称为SRAM(静态RAM)，SRAM(Static RAM)是静态存储器的英文缩写。由于SRAM采用了与制作CPU相同的半导体工艺，因此与动态存储器DRAM比较，SRAM的存取速度快，但体积较大，价格很高。
　　处理器缓存的基本思想是用少量的SRAM作为CPU与DRAM存储系统之间的缓冲区，即 Cache系统。80486以及更高档微处理器的一个显著特点是处理器芯片内集成了SRAM作为Cache，由于这些Cache装在芯片内，因此称为片内 Cache。486芯片内Cache的容量通常为8K。高档芯片如Pentium为16KB，Power PC可达32KB。Pentium微处理器进一步改进片内Cache，采用数据和双通道Cache技术，相对而言，片内Cache的容量不大，但是非常灵活、方便，极大地提高了微处理器的性能。片内Cache也称为一级Cache。由于486，586等高档处理器的时钟频率很高，一旦出现一级Cache未命中的情况，性能将明显恶化。在这种情况下采用的办法是在处理器芯片之外再加Cache，称为二级Cache。二级Cache实际上是CPU和主存之间的真正缓冲。由于系统板上的响应时间远低于CPU的速度，如果没有二级Cache就不可能达到486，586等高档处理器的理想速度。二级Cache的容量通常应比一级Cache大一个数量级以上。在系统设置中，常要求用户确定二级Cache是否安装及尺寸大小等。二级Cache的大小一般为128KB、 256KB或512KB。在486以上档次的微机中，普遍采用256KB或512KB同步Cache。所谓同步是指Cache和CPU采用了相同的时钟周期，以相同的速度同步工作。相对于异步Cache，性能可提高30%以上。
　　目前，PC及其服务器系统的发展趋势之一是CPU主频越做越高，系统架构越做越先进，而主存DRAM的结构和存取时间改进较慢。因此，缓存（Cache）技术愈显重要，在PC系统中Cache越做越大。广大用户已把Cache做为评价和选购PC系统的一个重要指标。
　　现在的CPU普遍有一级缓存和二级缓存。一般来说，一级缓存的数量比较少，而二级企业缓存的数量一般比一级缓存大几倍。为什么要缓存呢，这主要是CPU厂家为了提高CPU的使用效率。因为，随着CPU的速度的快速发展，目前的CPU速度已经达到一个令人惊讶的速度，据个例子来说，一个奔腾3-1G的CPU其运算速度为每秒钟能够完成10亿次二进制计算，而一个奔腾4-3G则意味着每秒钟能够完成 30亿次二进制运算。当然由于CPU还要介入浮点数据转换和介入控制主板上的其他设备资源，实际真正用于数据处理的资源会受到较大影响，但总体来说，CPU的速度已经达到一个前所未有的程度。由于其他硬件在数据传输方面未能跟上，因此，CPU厂家就在CPU内封装了缓存，其中，一级缓存主要将 CPU的硬指令长期存储，以便CPU在调用指令时不必再通过与内存交换数据来取得，另外，还将最近处理的进程数据（中间数据）存放在一级缓存；而二级缓存则是完全存放最近处理的进程数据（中间数据）和即将调用的数据。通过这样一来设置，就可以避免CPU运算过程中要频繁与内存交换数据，减少CPU的等待时间，提高CPU的利用效率。
